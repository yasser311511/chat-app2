<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WalChat</title>
    <link rel="icon" href="icon.png" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap');
        body { font-family: 'Cairo', sans-serif; }
        .chat-message {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .form-container { transition: all 0.3s ease; }
        .tab-button { transition: all 0.2s ease; }
        .avatar-option { transition: all 0.2s ease; }
        .avatar-option:hover { transform: scale(1.1); }
        .avatar-option.selected { border: 3px solid #3B82F6; }
        .notification {
            animation: notificationSlide 0.5s ease-out, notificationFade 5s forwards;
        }
        @keyframes notificationSlide {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes notificationFade {
            0%, 70% { opacity: 1; }
            100% { opacity: 0; }
        }
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
        .rank-badge {
            background: linear-gradient(45deg, #3B82F6, #8B5CF6);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            margin-left: 5px;
        }
        .messages-container {
            height: calc(100vh - 200px);
            overflow-y: auto;
        }
    
        .users-container {
            height: calc(100vh - 200px);
            overflow-y: auto;
        }
    
        /* Ù†Ø¶Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ù„Ø§ ÙŠÙ†Ø²Ø§Ø­ */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* Ø³Ø¨ÙŠÙ†Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        @media (max-width: 768px) {
            .users-container {
                position: fixed;
                top: 0;
                right: -100%;
                width: 80%;
                height: 100vh;
                z-index: 50;
                transition: right 0.3s ease;
                background: rgba(15, 23, 42, 0.95);
                backdrop-filter: blur(10px);
                padding: 1rem;
            }
            
            .users-container.show {
                right: 0;
            }
            
            .users-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 40;
            }
            
            .users-overlay.show {
                display: block;
            }
        }

        /* Ù†Ù…Ø· Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ */
        .profile-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .profile-modal.show {
            opacity: 1;
            visibility: visible;
        }
        
        .profile-content {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        .profile-modal.show .profile-content {
            transform: scale(1);
        }
        
        /* Ù†Ù…Ø· Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø®Ø§ØµØ© */
        .private-chat-modal {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 350px;
            height: 450px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 999;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transform: translateY(100%);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .private-chat-modal.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .private-chat-header {
            background: rgba(30, 41, 59, 0.8);
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .private-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        .private-chat-input {
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ø±Ø£Ø³ ÙˆØ§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
        .main-header {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 2rem;
        }
        
        .user-profile-btn {
            transition: all 0.3s ease;
        }
        
        .user-profile-btn:hover {
            transform: translateY(-2px);
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #EF4444;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ */
        .friends-sidebar {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            width: 300px;
            height: 100vh;
            position: fixed;
            top: 0;
            right: 0;
            z-index: 40;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            padding: 1rem;
            overflow-y: auto;
        }
        
        .friends-sidebar.show {
            transform: translateX(0);
        }
        
        .friends-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 30;
        }
        
        .friends-overlay.show {
            display: block;
        }
        
        .friend-item {
            transition: all 0.3s ease;
        }
        
        .friend-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen">
    <!-- Ø³Ø¨ÙŠÙ†Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ -->
    <div id="loadingSpinner" class="loading-overlay hidden">
        <div class="text-center">
            <div class="spinner mx-auto mb-4"></div>
            <p class="text-white text-lg">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p>
        </div>
    </div>

    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginPage" class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full border border-white/20 shadow-2xl">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">ğŸ’¬</div>
                <h1 class="text-3xl font-bold text-white mb-2">WalChat</h1>
                <p class="text-blue-200">Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ Ù„Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</p>
            </div>

            <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ -->
            <div class="flex bg-white/10 rounded-xl p-1 mb-6">
                <button id="loginTab" class="tab-button flex-1 py-2 px-4 rounded-xl font-semibold bg-blue-600 text-white">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
                <button id="registerTab" class="tab-button flex-1 py-2 px-4 rounded-xl font-semibold text-blue-200">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
            </div>

            <!-- Ù†Ù…ÙˆØ°Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
            <form id="loginForm" class="form-container space-y-4">
                <div>
                    <label class="block text-white text-sm font-semibold mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="loginUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required 
                        class="w-full bg-white/20 border border-white/30 rounded-lg px-4 py-3 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>

                <div>
                    <label class="block text-white text-sm font-semibold mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
                    <input type="password" id="loginPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" required 
                        class="w-full bg-white/20 border border-white/30 rounded-lg px-4 py-3 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>

                <div class="flex items-center">
                    <input type="checkbox" id="rememberMe" class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                    <label for="rememberMe" class="block text-white text-sm">ØªØ°ÙƒØ±Ù†ÙŠ</label>
                </div>

                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-xl transition-colors">
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </form>

            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ -->
            <form id="registerForm" class="form-container hidden space-y-4">
                <div>
                    <label class="block text-white text-sm font-semibold mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" id="registerUsername" placeholder="Ø§Ø®ØªØ± Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" required 
                        class="w-full bg-white/20 border border-white/30 rounded-lg px-4 py-3 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>

                <div>
                    <label class="block text-white text-sm font-semibold mb-2">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
                    <input type="password" id="registerPassword" placeholder="Ø§Ø®ØªØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" required 
                        class="w-full bg-white/20 border border-white/30 rounded-lg px-4 py-3 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>

                <div>
                    <label class="block text-white text-sm font-semibold mb-2">ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±</label>
                    <input type="password" id="confirmPassword" placeholder="Ø£Ø¹Ø¯ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" required 
                        class="w-full bg-white/20 border border-white/30 rounded-lg px-4 py-3 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>

                <div>
                    <label class="block text-white text-sm font-semibold mb-2">Ø§Ù„Ø¬Ù†Ø³</label>
                    <div class="grid grid-cols-2 gap-4">
                        <label class="flex items-center space-x-3 space-x-reverse bg-white/10 hover:bg-white/20 rounded-lg p-3 cursor-pointer transition-colors">
                            <input type="radio" name="gender" value="male" required class="text-blue-600 focus:ring-blue-500">
                            <span class="text-white">ğŸ‘¨ Ø°ÙƒØ±</span>
                        </label>
                        <label class="flex items-center space-x-3 space-x-reverse bg-white/10 hover:bg-white/20 rounded-lg p-3 cursor-pointer transition-colors">
                            <input type="radio" name="gender" value="female" required class="text-pink-600 focus:ring-pink-500">
                            <span class="text-white">ğŸ‘© Ø£Ù†Ø«Ù‰</span>
                        </label>
                    </div>
                </div>

                <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-4 rounded-xl transition-colors">
                    Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
                </button>
            </form>

            <div class="mt-6 bg-blue-900/30 rounded-lg p-3">
                <p class="text-xs text-blue-200 text-center">
                     Ø­Ø§ÙØ¸Ùˆ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø±Ø­ ÙˆØ§Ù„Ù…ØªØ¹Ø© !ğŸ’¡
                     Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø³Ø¨ ÙˆØ§Ù„Ø´ØªÙ… !ğŸ’¡
                     Ù…Ù…Ù†ÙˆØ¹ ØªÙƒÙˆÙŠÙ† Ø§Ù„Ø¹Ù„Ø§Ù‚Ø§Øª Ù‡Ù†Ø§ !ğŸ’¡
                     Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³Ø§Ø¡ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† !ğŸ’¡
                    <br>ğŸ›‘ Ø§ÙŠ Ø´Ø®Øµ ÙŠØ®Ø§Ù„Ù Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† ÙŠØ­Ø¸Ø± Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ !
                </p>
            </div>
        </div>
    </div>

    <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="mainPage" class="hidden min-h-screen">
        <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <header class="main-header flex justify-between items-center">
            <div></div> <!-- Ø¹Ù†ØµØ± ÙØ§Ø±Øº Ù„Ù„Ù…Ø³Ø§Ø­Ø© Ø§Ù„ÙŠØ³Ø±Ù‰ -->
            
            <h1 id="welcomeMessage" class="text-2xl font-bold text-white">ğŸ  ØºØ±Ù Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h1>
            
            <div class="flex items-center space-x-4 space-x-reverse">
                <!-- Ø²Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
                <div class="relative">
                    <button id="messagesButton" class="text-white p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors relative">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        <span id="messagesBadge" class="notification-badge hidden">0</span>
                    </button>
                </div>
                
                <!-- Ø²Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ -->
                <button id="friendsButton" class="text-white p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                </button>
                
                <!-- Ø²Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
                <button id="profileButton" class="user-profile-btn flex items-center space-x-2 space-x-reverse bg-white/10 hover:bg-white/20 rounded-full pl-3 pr-2 py-1 transition-colors">
                    <span class="text-white text-sm font-medium" id="headerUsername"></span>
                    <div class="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white">
                        <span id="headerAvatarInitial"></span>
                    </div>
                </button>
                
                <!-- Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ -->
                <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-full font-semibold transition-colors flex items-center space-x-2 space-x-reverse text-sm">
                    <span>Ø®Ø±ÙˆØ¬</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 01-3-3h4a3 3 0 013 3v1"></path>
                    </svg>
                </button>
            </div>
        </header>
       
        <div class="container mx-auto px-4 py-8">
            <div class="text-center mb-12">
                <p class="text-xl text-blue-200">Ø§Ø®ØªØ± ØºØ±ÙØ© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„ÙŠÙ‡Ø§</p>
            </div>
           
            <div id="roomsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 max-w-7xl mx-auto">
                <!-- Ø§Ù„ØºØ±Ù Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
            </div>
        </div>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
    <div id="chatPage" class="hidden min-h-screen flex flex-col">
        <!-- Ø±Ø£Ø³ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© -->
        <div class="bg-white/10 backdrop-blur-lg border-b border-white/20 p-4">
            <div class="container mx-auto flex items-center justify-between">
                <div class="flex items-center space-x-4 space-x-reverse">
                    <button onclick="goBack()" class="text-white hover:text-blue-200 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                        </svg>
                    </button>
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div id="chatIcon" class="text-3xl"></div>
                        <div>
                            <h2 id="chatTitle" class="text-xl font-semibold text-white"></h2>
                            <p class="text-sm text-blue-200">Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-2 space-x-reverse">
                    <button id="toggleUsersButton" class="md:hidden text-white p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                        </svg>
                    </button>
                    <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                    <span class="text-white text-sm">Ù†Ø´Ø·</span>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-content">
            <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
            <div class="flex-1 overflow-hidden p-4">
                <div id="messagesContainer" class="container mx-auto max-w-4xl space-y-4 messages-container custom-scrollbar">
                    <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
                </div>
            </div>

            <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† -->
            <div id="onlineUsersPanel" class="hidden md:block w-80 bg-white/5 backdrop-blur-lg border-l border-white/10 p-4 users-container custom-scrollbar">
                <h3 class="text-white font-bold mb-4 flex items-center space-x-2 space-x-reverse">
                    <span class="w-3 h-3 bg-green-500 rounded-full"></span>
                    <span>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†</span>
                    <span id="onlineUsersCount" class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">0</span>
                </h3>
        
                <div id="onlineUsersList" class="space-y-3">
                    <!-- Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ† Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„Ù‡Ù… Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>
            
            <!-- Ø²Ø± Ø¥Ø®ÙØ§Ø¡/Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ù„Ù„Ø¬ÙˆØ§Ù„ -->
            <div id="usersOverlay" class="users-overlay" onclick="toggleUsersList()"></div>
        </div>

        <!-- Ù…Ù†Ø·Ù‚Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
        <div id="messageArea" class="bg-white/10 backdrop-blur-lg border-t border-white/20 p-4">
            <div class="container mx-auto max-w-4xl">
                <!-- Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ØªØ¨ -->
                <div id="rankManagementPanel" class="hidden mb-4 bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-xl p-4 border border-purple-500/50">
                    <h3 class="text-white font-bold mb-3 flex items-center space-x-2 space-x-reverse">
                        <span>ğŸ‘‘</span>
                        <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ØªØ¨</span>
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-white text-sm font-semibold mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                            <input
                                type="text"
                                id="rankUserName"
                                placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…..."
                                class="w-full bg-white/20 border border-purple-300/50 rounded-lg px-4 py-2 text-white placeholder-purple-200 focus:outline-none focus:ring-2 focus:ring-purple-400"
                            >
                        </div>
                        <div>
                            <label class="block text-white text-sm font-semibold mb-2">Ø§Ù„Ø±ØªØ¨Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                            <select
                                id="rankSelect"
                                class="w-full bg-white/20 border border-purple-300/50 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-400"
                            >
                                <option value="" class="bg-gray-800">Ø§Ø®ØªØ± Ø§Ù„Ø±ØªØ¨Ø©...</option>
                                <option value="Ø¬ÙŠØ¯" class="bg-gray-800">â‡ï¸ Ø¬ÙŠØ¯</option>
                                <option value="Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…" class="bg-gray-800">ğŸ’ Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…</option>
                                <option value="Ø§Ø¯Ù…Ù†" class="bg-gray-800">ğŸ›¡ï¸ Ø§Ø¯Ù…Ù†</option>
                                <option value="Ø³ÙˆØ¨Ø± Ø§Ø¯Ù…Ù†" class="bg-gray-800">â­ Ø³ÙˆØ¨Ø± Ø§Ø¯Ù…Ù†</option>
                                <option value="Ù…Ù†Ø´Ø¦" class="bg-gray-800">ğŸ‘‘ Ù…Ù†Ø´Ø¦</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex space-x-4 space-x-reverse">
                        <button
                            onclick="assignRank()"
                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors flex items-center space-x-2 space-x-reverse"
                        >
                            <span>Ù…Ù†Ø­ Ø§Ù„Ø±ØªØ¨Ø©</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                        </button>
                        <button
                            onclick="removeRank()"
                            class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors flex items-center space-x-2 space-x-reverse"
                        >
                            <span>Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±ØªØ¨Ø©</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                            </svg>
                        </button>
                        <button
                            onclick="showAllRanks()"
                            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors flex items-center space-x-2 space-x-reverse"
                        >
                            <span>Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±ØªØ¨</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
                <div id="userManagementPanel" class="hidden mb-4 bg-gradient-to-r from-red-900/30 to-orange-900/30 rounded-xl p-4 border border-red-500/50">
                    <h3 class="text-white font-bold mb-3 flex items-center space-x-2 space-x-reverse">
                        <span>ğŸ‘‘</span>
                        <span id="managementTitle">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</span>
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-white text-sm font-semibold mb-2">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                            <input
                                type="text"
                                id="managedUserName"
                                placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…..."
                                class="w-full bg-white/20 border border-red-300/50 rounded-lg px-4 py-2 text-white placeholder-red-200 focus:outline-none focus:ring-2 focus:ring-red-400"
                            >
                        </div>
                        <div>
                            <label class="block text-white text-sm font-semibold mb-2">Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</label>
                            <select
                                id="userActionSelect"
                                class="w-full bg-white/20 border border-red-300/50 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-red-400"
                                onchange="toggleManagementFields()"
                            >
                                <option value="" class="bg-gray-800">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡...</option>
                                <option value="mute" class="bg-gray-800">ğŸ”‡ ÙƒØªÙ…</option>
                                <option value="unmute" class="bg-gray-800">ğŸ”Š Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒØªÙ…</option>
                                <option value="banFromRoom" class="bg-gray-800">ğŸš« Ø­Ø¸Ø± Ù…Ù† Ø§Ù„ØºØ±ÙØ©</option>
                                <option value="unbanFromRoom" class="bg-gray-800">âœ… Ø¥Ø²Ø§Ù„Ø© Ø­Ø¸Ø± Ø§Ù„ØºØ±ÙØ©</option>
                                <option value="banFromSite" class="bg-gray-800">â›” Ø­Ø¸Ø± Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</option>
                                <option value="unbanFromSite" class="bg-gray-800">ğŸŒ Ø¥Ø²Ø§Ù„Ø© Ø­Ø¸Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹</option>
                                <option value="deleteUser" class="bg-gray-800">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</option>
                                <option value="showStatus" class="bg-gray-800">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø­Ø§Ù„Ø©</option>
                            </select>
                        </div>
                    </div>
                    
                    <div id="durationField" class="hidden mb-4">
                        <label class="block text-white text-sm font-semibold mb-2">Ù…Ø¯Ø© Ø§Ù„ÙƒØªÙ… (Ø¯Ù‚Ø§Ø¦Ù‚)</label>
                        <input
                            type="number"
                            id="muteDuration"
                            placeholder="Ø§Ù„Ù…Ø¯Ø© Ø¨Ø§Ù„Ø¯Ù‚Ø§Ø¦Ù‚..."
                            min="1"
                            class="w-full bg-white/20 border border-red-300/50 rounded-lg px-4 py-2 text-white placeholder-red-200 focus:outline-none focus:ring-2 focus:ring-red-400"
                        >
                    </div>
                    
                    <div id="reasonField" class="hidden mb-4">
                        <label class="block text-white text-sm font-semibold mb-2">Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input
                            type="text"
                            id="banReason"
                            placeholder="Ø£Ø¯Ø®Ù„ Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø¸Ø±..."
                            class="w-full bg-white/20 border border-red-300/50 rounded-lg px-4 py-2 text-white placeholder-red-200 focus:outline-none focus:ring-2 focus:ring-red-400"
                        >
                    </div>
                    
                    <div class="flex space-x-4 space-x-reverse">
                        <button
                            onclick="manageUser()"
                            class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors flex items-center space-x-2 space-x-reverse"
                        >
                            <span>ØªÙ†ÙÙŠØ°</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </button>
                        <button
                            onclick="clearManagementFields()"
                            class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded-lg font-semibold transition-colors flex items-center space-x-2 space-x-reverse"
                        >
                            <span>Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ± Ø§Ù„Ø´Ø®ØµÙŠØ© -->
                <div id="avatarManagementPanel" class="hidden mb-4 bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-xl p-4 border border-purple-500/50">
                    <h3 class="text-white font-bold mb-3 flex items-center space-x-2 space-x-reverse">
                        <span>ğŸ–¼ï¸</span>
                        <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</span>
                    </h3>
                    
                    <div class="mb-4">
                        <label class="block text-white text-sm font-semibold mb-2">Ø§Ù„ØµÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©</label>
                        <div class="grid grid-cols-3 gap-3 mb-4">
                            <!-- ØµÙˆØ± Ø§Ù„Ø£ÙˆÙ„Ø§Ø¯ -->
                            <div class="avatar-option" onclick="selectAvatar('boy1')">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=boy1" class="w-full h-16 object-cover rounded-lg cursor-pointer" alt="ØµÙˆØ±Ø© ÙˆÙ„Ø¯ 1">
                            </div>
                            <div class="avatar-option" onclick="selectAvatar('boy2')">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=boy2" class="w-full h-16 object-cover rounded-lg cursor-pointer" alt="ØµÙˆØ±Ø© ÙˆÙ„Ø¯ 2">
                            </div>
                            <div class="avatar-option" onclick="selectAvatar('boy3')">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=boy3" class="w-full h-16 object-cover rounded-lg cursor-pointer" alt="ØµÙˆØ±Ø© ÙˆÙ„Ø¯ 3">
                            </div>
                            <!-- ØµÙˆØ± Ø§Ù„Ø¨Ù†Ø§Øª -->
                            <div class="avatar-option" onclick="selectAvatar('girl1')">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=girl1&hair=long" class="w-full h-16 object-cover rounded-lg cursor-pointer" alt="ØµÙˆØ±Ø© Ø¨Ù†Øª 1">
                            </div>
                            <div class="avatar-option" onclick="selectAvatar('girl2')">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=girl2&hair=long" class="w-full h-16 object-cover rounded-lg cursor-pointer" alt="ØµÙˆØ±Ø© Ø¨Ù†Øª 2">
                            </div>
                            <div class="avatar-option" onclick="selectAvatar('girl3')">
                                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=girl3&hair=long" class="w-full h-16 object-cover rounded-lg cursor-pointer" alt="ØµÙˆØ±Ø© Ø¨Ù†Øª 3">
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-white text-sm font-semibold mb-2">Ø±ÙØ¹ ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©</label>
                        <div class="flex items-center space-x-3 space-x-reverse">
                            <input
                                type="file"
                                id="avatarUpload"
                                accept="image/*"
                                class="hidden"
                                onchange="handleAvatarUpload()"
                            >
                            <label for="avatarUpload" class="flex-1 bg-white/20 border border-purple-300/50 rounded-lg px-4 py-2 text-white text-center cursor-pointer hover:bg-white/30">
                                Ø§Ø®ØªØ± ØµÙˆØ±Ø©
                            </label>
                            <button
                                onclick="resetAvatar()"
                                class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-semibold transition-colors"
                            >
                                Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†
                            </button>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <div class="inline-block bg-white/20 p-2 rounded-lg mb-2">
                            <img id="currentAvatarPreview" src="https://api.dicebear.com/7.x/avataaars/svg?seed=guest" class="w-16 h-16 rounded-full object-cover" alt="Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©">
                        </div>
                        <p class="text-xs text-purple-200">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</p>
                    </div>
                </div>
               
                <div id="messageInputContainer" class="flex space-x-4 space-x-reverse">
                    <input
                        type="text"
                        id="messageInput"
                        placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
                        class="flex-1 bg-white/20 border border-white/30 rounded-full px-6 py-3 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent"
                        onkeypress="handleKeyPress(event)"
                    >
                    <button
                        onclick="sendMessage()"
                        class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-full font-semibold transition-colors flex items-center space-x-2 space-x-reverse"
                    >
                        <span>Ø¥Ø±Ø³Ø§Ù„</span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ -->
    <div id="profileModal" class="profile-modal">
        <div class="profile-content">
            <div class="text-center mb-6">
                <button onclick="closeProfileModal()" class="absolute top-4 left-4 text-white hover:text-blue-200">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
                <img id="profileAvatar" src="" class="w-24 h-24 rounded-full mx-auto mb-4 object-cover border-4 border-blue-500/50">
                <h2 id="profileUsername" class="text-2xl font-bold text-white"></h2>
                <div id="profileRank" class="inline-block mt-2 px-3 py-1 rounded-full text-sm font-semibold text-white"></div>
                <div id="profileStatus" class="mt-2 flex items-center justify-center space-x-2">
                    <span class="w-3 h-3 rounded-full"></span>
                    <span class="text-sm text-blue-200"></span>
                </div>
            </div>
            
            <div class="text-center space-y-3">
                <button id="privateChatButton" onclick="startPrivateChat()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full font-semibold transition-colors flex items-center space-x-2 space-x-reverse mx-auto">
                    <span>Ù…Ø­Ø§Ø¯Ø«Ø© Ø®Ø§ØµØ©</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                    </svg>
                </button>
                
                <button id="addFriendButton" onclick="sendFriendRequest()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-full font-semibold transition-colors flex items-center space-x-2 space-x-reverse mx-auto">
                    <span>Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø®Ø§ØµØ© -->
    <div id="privateChatModal" class="private-chat-modal">
        <div class="private-chat-header">
            <div class="flex items-center space-x-3 space-x-reverse">
                <img id="privateChatAvatar" src="" class="w-8 h-8 rounded-full object-cover" onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=guest'">
                <div>
                    <h3 id="privateChatUsername" class="text-white font-semibold"></h3>
                    <p id="privateChatStatus" class="text-xs text-blue-200 flex items-center space-x-1 space-x-reverse">
                        <span class="w-2 h-2 rounded-full"></span>
                        <span></span>
                    </p>
                </div>
            </div>
            <button onclick="closePrivateChat()" class="text-white hover:text-blue-200">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <div id="privateChatMessages" class="private-chat-messages custom-scrollbar">
            <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
        </div>
        
        <div class="private-chat-input">
            <div class="flex space-x-3 space-x-reverse">
                <input
                    type="text"
                    id="privateMessageInput"
                    placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."
                    class="flex-1 bg-white/20 border border-white/30 rounded-full px-4 py-2 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-sm"
                    onkeypress="handlePrivateKeyPress(event)"
                >
                <button
                    onclick="sendPrivateMessage()"
                    class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full font-semibold transition-colors flex items-center space-x-2 space-x-reverse text-sm"
                >
                    <span>Ø¥Ø±Ø³Ø§Ù„</span>
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ -->
    <div id="friendsSidebar" class="friends-sidebar">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-white">ğŸ‘¥ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡</h2>
            <button onclick="closeFriendsSidebar()" class="text-white hover:text-blue-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <!-- Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
        <div class="mb-6">
            <div class="relative">
                <input
                    type="text"
                    id="userSearchInput"
                    placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†..."
                    class="w-full bg-white/20 border border-white/30 rounded-full px-4 py-2 text-white placeholder-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-sm"
                >
                <button onclick="searchUsers()" class="absolute left-2 top-1/2 transform -translate-y-1/2 text-blue-200 hover:text-white">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </button>
            </div>
            <div id="searchResults" class="mt-3 hidden bg-white/10 rounded-lg p-3 max-h-40 overflow-y-auto">
                <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>
        
        <!-- Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ¯Ø§Ù‚Ø© -->
        <div class="mb-6">
            <h3 class="text-white font-semibold mb-3 flex items-center space-x-2 space-x-reverse">
                <span>ğŸ“©</span>
                <span>Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ¯Ø§Ù‚Ø©</span>
                <span id="friendRequestsCount" class="bg-blue-600 text-white text-xs px-2 py-1 rounded-full">0</span>
            </h3>
            <div id="friendRequestsList" class="space-y-2">
                <!-- Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ¯Ø§Ù‚Ø© Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>
        
        <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ -->
        <div>
            <h3 class="text-white font-semibold mb-3 flex items-center space-x-2 space-x-reverse">
                <span>ğŸ‘¥</span>
                <span>Ø£ØµØ¯Ù‚Ø§Ø¦ÙŠ</span>
                <span id="friendsCount" class="bg-green-600 text-white text-xs px-2 py-1 rounded-full">0</span>
            </h3>
            <div id="friendsList" class="space-y-2">
                <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
            </div>
        </div>
    </div>
    
    <div id="friendsOverlay" class="friends-overlay" onclick="closeFriendsSidebar()"></div>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© -->
    <div id="globalNotifications" class="fixed top-4 right-4 z-50 space-y-3 max-w-sm"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentUser = null;
        let currentRoom = null;
        let rooms = [];
        let sessionChecked = false;
        let privateChatTarget = null;
        let friendRequests = [];
        let friendsList = [];

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø±ØªØ¨
        const ranks = {
            'ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹': { color: 'from-red-600 to-orange-400', icon: 'ğŸ†', level: 6 },
            'Ù…Ù†Ø´Ø¦': { color: 'from-yellow-400 to-orange-500', icon: 'ğŸ‘‘', level: 5 },
            'Ø³ÙˆØ¨Ø± Ø§Ø¯Ù…Ù†': { color: 'from-red-500 to-pink-600', icon: 'â­', level: 4 },
            'Ø§Ø¯Ù…Ù†': { color: 'from-purple-500 to-indigo-600', icon: 'ğŸ›¡ï¸', level: 3 },
            'Ø¨Ø±ÙŠÙ…ÙŠÙˆÙ…': { color: 'from-green-500 to-emerald-600', icon: 'ğŸ’', level: 2 },
            'Ø¬ÙŠØ¯': { color: 'from-blue-500 to-cyan-600', icon: 'â‡ï¸', level: 1 }
        };

        // ØµÙˆØ± Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
        const defaultAvatars = {
            'boy1': 'https://api.dicebear.com/7.x/avataaars/svg?seed=boy1',
            'boy2': 'https://api.dicebear.com/7.x/avataaars/svg?seed=boy2',
            'boy3': 'https://api.dicebear.com/7.x/avataaars/svg?seed=boy3',
            'girl1': 'https://api.dicebear.com/7.x/avataaars/svg?seed=girl1&hair=long',
            'girl2': 'https://api.dicebear.com/7.x/avataaars/svg?seed=girl2&hair=long',
            'girl3': 'https://api.dicebear.com/7.x/avataaars/svg?seed=girl3&hair=long',
            'guest': 'https://api.dicebear.com/7.x/avataaars/svg?seed=guest'
        };

        // Ø¹Ù†Ø§ØµØ± ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const toggleUsersButton = document.getElementById('toggleUsersButton');
        const onlineUsersPanel = document.getElementById('onlineUsersPanel');
        const usersOverlay = document.getElementById('usersOverlay');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const profileButton = document.getElementById('profileButton');
        const messagesButton = document.getElementById('messagesButton');
        const friendsButton = document.getElementById('friendsButton');

        // ØªØ­ÙˆÙŠÙ„ Ø¨ÙŠÙ† Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„Ø¯Ø®ÙˆÙ„
        loginTab.addEventListener('click', () => {
            loginForm.classList.remove('hidden');
            registerForm.classList.add('hidden');
            loginTab.classList.add('bg-blue-600', 'text-white');
            loginTab.classList.remove('text-blue-200');
            registerTab.classList.add('text-blue-200');
            registerTab.classList.remove('bg-blue-600', 'text-white');
        });

        registerTab.addEventListener('click', () => {
            registerForm.classList.remove('hidden');
            loginForm.classList.add('hidden');
            registerTab.classList.add('bg-blue-600', 'text-white');
            registerTab.classList.remove('text-blue-200');
            loginTab.classList.add('text-blue-200');
            loginTab.classList.remove('bg-blue-600', 'text-white');
        });

        // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        profileButton.addEventListener('click', () => {
            showUserProfileModal(currentUser.name);
        });

        messagesButton.addEventListener('click', () => {
            // Ø§ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø£Ùˆ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
            openFriendsSidebar();
        });

        friendsButton.addEventListener('click', () => {
            openFriendsSidebar();
        });

        // Ø¥Ø¸Ù‡Ø§Ø± ÙˆØ¥Ø®ÙØ§Ø¡ Ø³Ø¨ÙŠÙ†Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
        function showLoading() {
            loadingSpinner.classList.remove('hidden');
        }

        function hideLoading() {
            loadingSpinner.classList.add('hidden');
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', () => {
            showLoading();
            const savedSession = localStorage.getItem('userSession');
            const savedRoom = localStorage.getItem('currentRoom');
            
            if (savedSession) {
                const sessionData = JSON.parse(savedSession);
                socket.emit('check session', sessionData.sessionId);
            } else {
                sessionChecked = true;
                hideLoading();
            }
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¬Ù„Ø³Ø©
        socket.on('session valid', (userData) => {
            currentUser = userData;
            updateHeaderUserInfo();
            showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ø¹ÙˆØ¯ØªÙƒ ${userData.name}! ğŸ˜Š`, 'success');
            showMainPage();
            
            // ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ¯Ø§Ù‚Ø© ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
            socket.emit('get friend requests', currentUser.name);
            socket.emit('get friends list', currentUser.name);
            
            // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
            const savedRoom = localStorage.getItem('currentRoom');
            if (savedRoom) {
                const roomData = JSON.parse(savedRoom);
                setTimeout(() => {
                    openChat(roomData.id, roomData.name, roomData.icon);
                }, 500);
            }
            
            sessionChecked = true;
            hideLoading();
        });

        socket.on('session invalid', () => {
            localStorage.removeItem('userSession');
            localStorage.removeItem('currentRoom');
            sessionChecked = true;
            hideLoading();
        });

        // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø±Ø£Ø³
        function updateHeaderUserInfo() {
            if (currentUser) {
                document.getElementById('headerUsername').textContent = currentUser.name;
                document.getElementById('headerAvatarInitial').textContent = currentUser.name.charAt(0).toUpperCase();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
                socket.emit('get avatar', currentUser.name);
            }
        }

        socket.on('avatar data', (data) => {
            if (data.username === currentUser.name && data.avatarUrl) {
                const headerAvatar = document.querySelector('#profileButton .w-8.h-8');
                if (headerAvatar) {
                    headerAvatar.innerHTML = `<img src="${data.avatarUrl}" class="w-8 h-8 rounded-full object-cover" alt="${data.username}">`;
                }
            }
        });

        // Ù…Ø¹Ø§Ù„Ø¬Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            showLoading();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            socket.emit('user login', { username, password, rememberMe });
        });

        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
        registerForm.addEventListener('submit', (e) => {
            e.preventDefault();
            showLoading();
            const username = document.getElementById('registerUsername').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const gender = document.querySelector('input[name="gender"]:checked')?.value;
            
            if (password !== confirmPassword) {
                showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©!', 'error');
                hideLoading();
                return;
            }
            
            if (!gender) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¬Ù†Ø³!', 'error');
                hideLoading();
                return;
            }
            
            socket.emit('user register', { username, password, gender });
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù†ØªØ§Ø¦Ø¬ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        socket.on('login success', (userData) => {
            currentUser = userData;
            socket.emit('update session', { 
                sessionId: userData.sessionId, 
                username: userData.name, 
                password: userData.password 
            });
            
            // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¥Ø°Ø§ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø°Ù„Ùƒ
            if (document.getElementById('rememberMe').checked) {
                localStorage.setItem('userSession', JSON.stringify({
                    username: userData.name,
                    sessionId: userData.sessionId
                }));
            }
            
            updateHeaderUserInfo();
            showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ ${userData.name}! ğŸ˜Š`, 'success');
            showMainPage();
            
            // ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ¯Ø§Ù‚Ø© ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
            socket.emit('get friend requests', currentUser.name);
            socket.emit('get friends list', currentUser.name);
            
            hideLoading();
        });

        socket.on('login error', (error) => {
            showNotification(error, 'error');
            hideLoading();
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù†ØªØ§Ø¦Ø¬ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
        socket.on('register success', (userData) => {
            currentUser = userData;
            
            // Ø­ÙØ¸ Ø§Ù„Ø¬Ù„Ø³Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯
            localStorage.setItem('userSession', JSON.stringify({
                username: userData.name,
                sessionId: userData.sessionId
            }));
            
            updateHeaderUserInfo();
            showNotification(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! ğŸ˜Š`, 'success');
            showMainPage();
            
            // ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ¯Ø§Ù‚Ø© ÙˆÙ‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
            socket.emit('get friend requests', currentUser.name);
            socket.emit('get friends list', currentUser.name);
            
            hideLoading();
        });

        socket.on('register error', (error) => {
            showNotification(error, 'error');
            hideLoading();
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØºØ±Ù
        socket.on('rooms update', (updatedRooms) => {
            rooms = updatedRooms;
            loadRooms();
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        socket.on('users update', (users) => {
            updateOnlineUsersList(users);
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø¯ÙŠØ¯Ø©
        socket.on('new message', (message) => {
            if (message.type === 'user') {
                addMessageToChat(message.user, message.content, message.time, message.user === currentUser.name, message.rank, message.avatar);
            } else {
                addSystemMessage(message.content, message.time);
            }
            // ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„ Ø¹Ù†Ø¯ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
            setTimeout(scrollToBottom, 100);
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø±ØªØ¨
        socket.on('rank notification', (message) => {
            addSystemMessage(message.content, message.time);
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        socket.on('chat history', (messages) => {
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';
            
            messages.forEach(msg => {
                if (msg.type === 'user') {
                    addMessageToChat(msg.user, msg.content, msg.time, msg.user === currentUser.name, msg.rank, msg.avatar);
                } else {
                    addSystemMessage(msg.content, msg.time);
                }
            });
            // ØªÙ…Ø±ÙŠØ± Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø³ÙÙ„ Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
            setTimeout(scrollToBottom, 100);
            hideLoading();
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø±ØªØ¨
        socket.on('rank success', (message) => {
            showNotification(message, 'success');
        });

        socket.on('rank error', (error) => {
            showNotification(error, 'error');
        });

        socket.on('show ranks', (message) => {
            addSystemMessage(message.content, message.time);
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        socket.on('message error', (error) => {
            showNotification(error, 'error');
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØµÙˆØ±
        socket.on('avatar updated', (data) => {
            showNotification(`ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© Ù„Ù€ ${data.username}`, 'success');
            updateAvatarPreview();
            updateHeaderUserInfo();
        });

        socket.on('avatar error', (error) => {
            showNotification(error, 'error');
        });

        socket.on('avatar data', (data) => {
            if (data.avatarUrl) {
                document.getElementById('currentAvatarPreview').src = data.avatarUrl;
            }
        });

        socket.on('user avatar updated', (data) => {
            updateOnlineUsersAvatars(data.username, data.avatarUrl);
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ù†ØªØ§Ø¦Ø¬ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        socket.on('management success', (message) => {
            showNotification(message, 'success');
        });

        socket.on('management error', (error) => {
            showNotification(error, 'error');
        });

        socket.on('user status', (message) => {
            addSystemMessage(message.content, message.time);
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø¸Ø±
        socket.on('banned from room', (data) => {
            showNotification(`ØªÙ… Ø­Ø¸Ø±Ùƒ Ù…Ù† ØºØ±ÙØ© ${data.room}. Ø§Ù„Ø³Ø¨Ø¨: ${data.reason}`, 'error');
            goBack();
        });

        socket.on('banned from site', (data) => {
            showNotification(`ØªÙ… Ø­Ø¸Ø±Ùƒ Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„. Ø§Ù„Ø³Ø¨Ø¨: ${data.reason}`, 'error');
            logout();
        });

        socket.on('user deleted', () => {
            showNotification('ØªÙ… Ø­Ø°Ù Ø­Ø³Ø§Ø¨Ùƒ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©', 'error');
            logout();
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ
        socket.on('user profile data', (data) => {
            showUserProfile(data);
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„ Ø®Ø§ØµØ©
        socket.on('private message sent', (message) => {
            addPrivateMessageToChat(message, true);
        });

        socket.on('new private message', (message) => {
            if (privateChatTarget && message.from === privateChatTarget) {
                addPrivateMessageToChat(message, false);
            } else {
                showNotification(`Ø±Ø³Ø§Ù„Ø© Ø®Ø§ØµØ© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† ${message.from}`, 'info');
                updateMessagesBadge();
            }
        });

        socket.on('private messages history', (messages) => {
            const container = document.getElementById('privateChatMessages');
            container.innerHTML = '';
            
            messages.forEach(msg => {
                addPrivateMessageToChat(msg, msg.from === currentUser.name);
            });
            
            setTimeout(() => {
                container.scrollTop = container.scrollHeight;
            }, 100);
        });

        // Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø£Ø­Ø¯Ø§Ø« Ù†Ø¸Ø§Ù… Ø§Ù„ØµØ¯Ø§Ù‚Ø§Øª
        socket.on('new friend request', (data) => {
            showNotification(`Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${data.fromUser}`, 'info');
            updateFriendRequests();
            updateMessagesBadge();
        });

        socket.on('friend request sent', (message) => {
            showNotification(message, 'success');
        });

        socket.on('friend request error', (error) => {
            showNotification(error, 'error');
        });

        socket.on('friend request accepted', (data) => {
            showNotification(`Ù‚Ø¨Ù„ ${data.byUser} Ø·Ù„Ø¨ Ø§Ù„ØµØ¯Ø§Ù‚Ø©`, 'success');
            updateFriendsList();
        });

        socket.on('friend request processed', (message) => {
            showNotification(message, 'success');
            updateFriendRequests();
        });

        socket.on('friend removed', (message) => {
            showNotification(message, 'success');
            updateFriendsList();
        });

        socket.on('friend removed you', (data) => {
            showNotification(`Ø£Ø²Ø§Ù„Ùƒ ${data.byUser} Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡`, 'info');
            updateFriendsList();
        });

        socket.on('friend error', (error) => {
            showNotification(error, 'error');
        });

        socket.on('friend requests list', (requests) => {
            friendRequests = requests;
            updateFriendRequests();
            updateMessagesBadge();
        });

        socket.on('friends list', (friends) => {
            friendsList = friends;
            updateFriendsList();
        });

        socket.on('search results', (results) => {
            displaySearchResults(results);
        });

        // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ù„Ù„Ø¬ÙˆØ§Ù„
        toggleUsersButton.addEventListener('click', toggleUsersList);
        
        function toggleUsersList() {
            onlineUsersPanel.classList.toggle('show');
            usersOverlay.classList.toggle('show');
        }

        // ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
        function openFriendsSidebar() {
            document.getElementById('friendsSidebar').classList.add('show');
            document.getElementById('friendsOverlay').classList.add('show');
        }

        function closeFriendsSidebar() {
            document.getElementById('friendsSidebar').classList.remove('show');
            document.getElementById('friendsOverlay').classList.remove('show');
        }

        // ØªØ­Ø¯ÙŠØ« Ø·Ù„Ø¨Ø§Øª Ø§Ù„ØµØ¯Ø§Ù‚Ø©
        function updateFriendRequests() {
            const container = document.getElementById('friendRequestsList');
            const countElement = document.getElementById('friendRequestsCount');
            
            if (!container || !countElement) return;
            
            container.innerHTML = '';
            countElement.textContent = friendRequests.length;
            
            if (friendRequests.length === 0) {
                container.innerHTML = '<p class="text-blue-200 text-sm text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª ØµØ¯Ø§Ù‚Ø©</p>';
                return;
            }
            
            friendRequests.forEach(username => {
                const requestDiv = document.createElement('div');
                requestDiv.className = 'flex items-center justify-between bg-white/5 rounded-lg p-3 friend-item';
                requestDiv.innerHTML = `
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center text-white">
                            ${username.charAt(0).toUpperCase()}
                        </div>
                        <span class="text-white font-medium">${username}</span>
                    </div>
                    <div class="flex space-x-2 space-x-reverse">
                        <button onclick="acceptFriendRequest('${username}')" class="text-green-500 hover:text-green-300">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                            </svg>
                        </button>
                        <button onclick="rejectFriendRequest('${username}')" class="text-red-500 hover:text-red-300">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                `;
                container.appendChild(requestDiv);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡
        function updateFriendsList() {
            const container = document.getElementById('friendsList');
            const countElement = document.getElementById('friendsCount');
            
            if (!container || !countElement) return;
            
            container.innerHTML = '';
            countElement.textContent = friendsList.length;
            
            if (friendsList.length === 0) {
                container.innerHTML = '<p class="text-blue-200 text-sm text-center">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ØµØ¯Ù‚Ø§Ø¡ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>';
                return;
            }
            
            friendsList.forEach(username => {
                const friendDiv = document.createElement('div');
                friendDiv.className = 'flex items-center justify-between bg-white/5 rounded-lg p-3 friend-item';
                friendDiv.innerHTML = `
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center text-white">
                            ${username.charAt(0).toUpperCase()}
                        </div>
                        <span class="text-white font-medium">${username}</span>
                    </div>
                    <div class="flex space-x-2 space-x-reverse">
                        <button onclick="showUserProfileModal('${username}')" class="text-blue-500 hover:text-blue-300">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                        </button>
                        <button onclick="removeFriend('${username}')" class="text-red-500 hover:text-red-300">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                    </div>
                `;
                container.appendChild(friendDiv);
            });
        }

        // ØªØ­Ø¯ÙŠØ« Ø´Ø§Ø±Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        function updateMessagesBadge() {
            const badge = document.getElementById('messagesBadge');
            const totalNotifications = friendRequests.length;
            
            if (badge) {
                if (totalNotifications > 0) {
                    badge.textContent = totalNotifications;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            }
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function searchUsers() {
            const query = document.getElementById('userSearchInput').value.trim();
            
            if (query.length < 2) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„è‡³å°‘ Ø­Ø±ÙÙŠÙ† Ù„Ù„Ø¨Ø­Ø«', 'error');
                return;
            }
            
            socket.emit('search users', {
                query: query,
                currentUser: currentUser.name
            });
        }

        function displaySearchResults(results) {
            const container = document.getElementById('searchResults');
            
            if (!container) return;
            
            container.innerHTML = '';
            container.classList.remove('hidden');
            
            if (results.length === 0) {
                container.innerHTML = '<p class="text-blue-200 text-sm text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>';
                return;
            }
            
            results.forEach(username => {
                const resultDiv = document.createElement('div');
                resultDiv.className = 'flex items-center justify-between py-2';
                resultDiv.innerHTML = `
                    <div class="flex items-center space-x-3 space-x-reverse">
                        <div class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center text-white">
                            ${username.charAt(0).toUpperCase()}
                        </div>
                        <span class="text-white font-medium">${username}</span>
                    </div>
                    <button onclick="showUserProfileModal('${username}')" class="text-blue-500 hover:text-blue-300 text-sm">
                        Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù
                    </button>
                `;
                container.appendChild(resultDiv);
            });
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚Ø©
        function sendFriendRequest() {
            const profileUsername = document.getElementById('profileUsername').textContent;
            
            if (profileUsername === currentUser.name) {
                showNotification('Ù„Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚Ø© Ù„Ù†ÙØ³Ùƒ', 'error');
                return;
            }
            
            socket.emit('send friend request', {
                fromUser: currentUser.name,
                toUser: profileUsername
            });
        }

        // Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚Ø©
        function acceptFriendRequest(username) {
            socket.emit('accept friend request', {
                fromUser: username,
                toUser: currentUser.name
            });
        }

        // Ø±ÙØ¶ Ø·Ù„Ø¨ ØµØ¯Ø§Ù‚Ø©
        function rejectFriendRequest(username) {
            socket.emit('reject friend request', {
                fromUser: username,
                toUser: currentUser.name
            });
        }

        // Ø¥Ø²Ø§Ù„Ø© ØµØ¯ÙŠÙ‚
        function removeFriend(username) {
            if (confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¨Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¥Ø²Ø§Ù„Ø© ${username} Ù…Ù† Ù‚Ø§Ø¦Ù…Ø© Ø£ØµØ¯Ù‚Ø§Ø¦ÙƒØŸ`)) {
                socket.emit('remove friend', {
                    username: currentUser.name,
                    friendToRemove: username
                });
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function showMainPage() {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            updateWelcomeMessage();
            
            // Ø·Ù„Ø¨ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØºØ±Ù Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
            fetch('/api/rooms')
                .then(response => response.json())
                .then(data => {
                    rooms = data;
                    loadRooms();
                });
        }

        // ØªØ­Ø¯ÙŠØ« Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
        function updateWelcomeMessage() {
            const welcomeElement = document.getElementById('welcomeMessage');
            if (welcomeElement && currentUser) {
                const rankBadge = currentUser.rank ? `(${ranks[currentUser.rank].icon} ${currentUser.rank})` : '';
                welcomeElement.innerHTML = `ğŸ  Ù…Ø±Ø­Ø¨Ø§Ù‹ ${currentUser.name} ${rankBadge}`;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØºØ±Ù
        function loadRooms() {
            const roomsContainer = document.getElementById('roomsContainer');
            roomsContainer.innerHTML = '';
            
            rooms.forEach(room => {
                const roomDiv = document.createElement('div');
                roomDiv.className = room.protected ? 
                    'bg-gradient-to-br from-red-900/30 to-orange-900/30 backdrop-blur-lg rounded-2xl p-6 hover:from-red-800/40 hover:to-orange-800/40 transition-all duration-300 relative group border-2 border-red-500/50' :
                    'bg-white/10 backdrop-blur-lg rounded-2xl p-6 hover:bg-white/20 transition-all duration-300 relative group';
                
                roomDiv.innerHTML = `
                    <div class="cursor-pointer" onclick="${room.protected ? `openProtectedChat(${room.id}, '${room.name}', '${room.icon}')` : `openChat(${room.id}, '${room.name}', '${room.icon}')`}">
                        <div class="text-4xl mb-4 text-center">${room.icon}</div>
                        <h3 class="text-xl font-semibold text-white text-center mb-2">${room.name}</h3>
                        <p class="text-blue-200 text-center text-sm">${room.description}</p>
                        <div class="mt-4 text-center">
                            <span class="${room.protected ? 'bg-red-600' : 'bg-gray-500'} text-white px-3 py-1 rounded-full text-xs">
                                ${room.protected ? 'ğŸ”’ Ù…Ø­Ù…ÙŠØ©' : 'Ø§Ù†Ù‚Ø± Ù„Ù„Ø¯Ø®ÙˆÙ„'}
                            </span>
                        </div>
                    </div>
                `;
                
                roomsContainer.appendChild(roomDiv);
            });
        }

        // ÙØªØ­ ØºØ±ÙØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        function openChat(roomId, roomName, icon) {
            showLoading();
            currentRoom = { id: roomId, name: roomName, icon: icon };
            
            // Ø­ÙØ¸ Ø§Ù„ØºØ±ÙØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            localStorage.setItem('currentRoom', JSON.stringify(currentRoom));
            
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('chatPage').classList.remove('hidden');
            document.getElementById('chatTitle').textContent = roomName;
            document.getElementById('chatIcon').textContent = icon;
            
            // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ÙÙŠ Ø±Ø£Ø³ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            document.getElementById('profileButton').classList.add('hidden');
            
            // Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù†ÙˆØ¹ Ø§Ù„ØºØ±ÙØ©
            const rankPanel = document.getElementById('rankManagementPanel');
            const userPanel = document.getElementById('userManagementPanel');
            const avatarPanel = document.getElementById('avatarManagementPanel');
            const messageInputContainer = document.getElementById('messageInputContainer');
            
            if (roomName === 'ØºØ±ÙØ© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©') {
                rankPanel.classList.remove('hidden');
                userPanel.classList.remove('hidden');
                avatarPanel.classList.add('hidden');
                messageInputContainer.classList.remove('hidden');
            } else if (roomName === 'ØºØ±ÙØ© ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø¸Ù‡Ø±') {
                rankPanel.classList.add('hidden');
                userPanel.classList.add('hidden');
                avatarPanel.classList.remove('hidden');
                messageInputContainer.classList.add('hidden');
                updateAvatarPreview();
            } else {
                rankPanel.classList.add('hidden');
                userPanel.classList.add('hidden');
                avatarPanel.classList.add('hidden');
                messageInputContainer.classList.remove('hidden');
            }
            
            // Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… Ù„Ù„ØºØ±ÙØ©
            socket.emit('join room', { roomId, user: currentUser });
        }

        // ÙØªØ­ ØºØ±ÙØ© Ù…Ø­Ù…ÙŠØ© Ø¨ÙƒÙ„Ù…Ø© Ø³Ø±
        function openProtectedChat(roomId, roomName, icon) {
            let password = '';
            
            if (roomName === 'ØºØ±ÙØ© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©') {
                password = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± ØºØ±ÙØ© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:');
                if (password !== 'admin123') {
                    showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!', 'error');
                    return;
                }
            } else if (roomName === 'ØºØ±ÙØ© ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø¸Ù‡Ø±') {
                password = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø³Ø± ØºØ±ÙØ© ØªØ®ØµÙŠØµ Ø§Ù„Ù…Ø¸Ù‡Ø±:');
                if (password !== 'a') {
                    showNotification('ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©!', 'error');
                    return;
                }
            }
            
            openChat(roomId, roomName, icon);
        }

        // Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function goBack() {
            if (currentRoom) {
                socket.emit('leave room', { roomId: currentRoom.id, user: currentUser });
                localStorage.removeItem('currentRoom');
            }
            document.getElementById('chatPage').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
            document.getElementById('messagesContainer').innerHTML = '';
            
            // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ÙÙŠ Ø§Ù„Ø±Ø£Ø³
            document.getElementById('profileButton').classList.remove('hidden');
            
            currentRoom = null;
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            if (currentRoom) {
                socket.emit('leave room', { roomId: currentRoom.id, user: currentUser });
            }
            
            // Ø­Ø°Ù Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
            localStorage.removeItem('userSession');
            localStorage.removeItem('currentRoom');
            
            currentUser = null;
            currentRoom = null;
            document.getElementById('mainPage').classList.add('hidden');
            document.getElementById('chatPage').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
           
            if (message && currentUser && currentRoom) {
                socket.emit('send message', { 
                    roomId: currentRoom.id, 
                    message, 
                    user: currentUser 
                });
                input.value = '';
            }
        }

        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ Enter
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©
        function addMessageToChat(user, message, time, isOwn, userRank, avatarUrl) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message flex ${isOwn ? 'justify-end' : 'justify-start'}`;
           
            let rankBadge = '';
           
            if (userRank) {
                const rankInfo = ranks[userRank];
                rankBadge = `
                    <div class="inline-flex items-center space-x-1 space-x-reverse bg-gradient-to-r ${rankInfo.color} px-2 py-1 rounded-full text-xs font-bold text-white shadow-lg mb-1">
                        <span>${rankInfo.icon}</span>
                        <span>${userRank}</span>
                    </div>
                `;
            }

            if (avatarUrl) {
                messageDiv.innerHTML = `
                    <div class="max-w-xs lg:max-w-md px-4 py-3 rounded-2xl ${
                        isOwn
                            ? 'bg-blue-600 text-white ml-4'
                            : 'bg-white/20 text-white mr-4'
                    }">
                        <div class="flex items-center space-x-3 space-x-reverse mb-2">
                            <img src="${avatarUrl}" class="w-8 h-8 rounded-full object-cover" alt="${user}" onclick="showUserProfileModal('${user}')" style="cursor:pointer">
                            <div>
                                ${rankBadge}
                                <div class="font-semibold text-sm ${isOwn ? 'text-blue-100' : 'text-blue-200'}" onclick="showUserProfileModal('${user}')" style="cursor:pointer">${user}</div>
                            </div>
                        </div>
                        <div class="text-sm leading-relaxed">${message}</div>
                        <div class="text-xs mt-2 opacity-70">${time}</div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="max-w-xs lg:max-w-md px-4 py-3 rounded-2xl ${
                        isOwn
                            ? 'bg-blue-600 text-white ml-4'
                            : 'bg-white/20 text-white mr-4'
                    }">
                        <div class="flex items-center space-x-3 space-x-reverse mb-2">
                            <div class="w-8 h-8 rounded-full bg-gray-400 flex items-center justify-center text-white" onclick="showUserProfileModal('${user}')" style="cursor:pointer">
                                ${user.charAt(0).toUpperCase()}
                            </div>
                            <div>
                                ${rankBadge}
                                <div class="font-semibold text-sm ${isOwn ? 'text-blue-100' : 'text-blue-200'}" onclick="showUserProfileModal('${user}')" style="cursor:pointer">${user}</div>
                            </div>
                        </div>
                        <div class="text-sm leading-relaxed">${message}</div>
                        <div class="text-xs mt-2 opacity-70">${time}</div>
                    </div>
                `;
            }
           
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù†Ø¸Ø§Ù…
        function addSystemMessage(message, time) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message flex justify-center';
           
            messageDiv.innerHTML = `
                <div class="max-w-md px-4 py-3 rounded-2xl bg-gradient-to-r from-yellow-600/80 to-orange-600/80 text-white text-center border border-yellow-500/50">
                    <div class="text-sm leading-relaxed">${message}</div>
                    <div class="text-xs mt-2 opacity-70">${time}</div>
                </div>
            `;
           
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù…ØªØµÙ„ÙŠÙ† Ù…Ø¹ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø±ØªØ¨Ø©
        function updateOnlineUsersList(users) {
            const onlineUsersList = document.getElementById('onlineUsersList');
            const onlineUsersCount = document.getElementById('onlineUsersCount');
            
            if (!onlineUsersList || !onlineUsersCount) return;
            
            onlineUsersCount.textContent = users.length;
            onlineUsersList.innerHTML = '';
            
            // ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø­Ø³Ø¨ Ø§Ù„Ø±ØªØ¨Ø© (Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø¯Ù†Ù‰)
            const sortedUsers = users.sort((a, b) => {
                const rankA = a.rank ? ranks[a.rank]?.level || 0 : 0;
                const rankB = b.rank ? ranks[b.rank]?.level || 0 : 0;
                
                // ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¯Ø§Ø¦Ù…Ø§Ù‹ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
                if (a.rank === 'ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹') return -1;
                if (b.rank === 'ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹') return 1;
                
                return rankB - rankA;
            });
            
            sortedUsers.forEach(user => {
                const userRank = user.rank;
                let rankBadge = '';
                
                if (userRank) {
                    const rankInfo = ranks[userRank];
                    rankBadge = `
                        <div class="inline-flex items-center space-x-1 space-x-reverse bg-gradient-to-r ${rankInfo.color} px-2 py-1 rounded-full text-xs font-bold text-white">
                            <span>${rankInfo.icon}</span>
                            <span>${userRank}</span>
                        </div>
                    `;
                }

                if (user.avatar) {
                    const userDiv = document.createElement('div');
                    userDiv.className = 'flex items-center space-x-3 space-x-reverse bg-white/5 rounded-lg p-3';
                    userDiv.innerHTML = `
                        <img src="${user.avatar}" class="w-10 h-10 rounded-full object-cover border-2 border-blue-500/50" alt="${user.name}" onclick="showUserProfileModal('${user.name}')" style="cursor:pointer">
                        <div class="flex-1 min-w-0">
                            <div class="text-white font-semibold truncate" onclick="showUserProfileModal('${user.name}')" style="cursor:pointer">${user.name}</div>
                            ${rankBadge}
                        </div>
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                    `;
                    onlineUsersList.appendChild(userDiv);
                } else {
                    const userDiv = document.createElement('div');
                    userDiv.className = 'flex items-center space-x-3 space-x-reverse bg-white/5 rounded-lg p-3';
                    userDiv.innerHTML = `
                        <div class="w-10 h-10 rounded-full bg-gray-400 flex items-center justify-center text-white border-2 border-blue-500/50" onclick="showUserProfileModal('${user.name}')" style="cursor:pointer">
                            ${user.name.charAt(0).toUpperCase()}
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="text-white font-semibold truncate" onclick="showUserProfileModal('${user.name}')" style="cursor:pointer">${user.name}</div>
                            ${rankBadge}
                        </div>
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                    `;
                    onlineUsersList.appendChild(userDiv);
                }
            });
            
            document.getElementById('onlineUsersPanel').classList.remove('hidden');
        }

        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø±ØªØ¨
        function assignRank() {
            const username = document.getElementById('rankUserName').value.trim();
            const selectedRank = document.getElementById('rankSelect').value;
            
            if (!username || !selectedRank) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø±ØªØ¨Ø©', 'error');
                return;
            }
            
            socket.emit('assign rank', { 
                username, 
                rank: selectedRank, 
                currentUser: { ...currentUser, roomId: currentRoom.id } 
            });
        }

        function removeRank() {
            const username = document.getElementById('rankUserName').value.trim();
            
            if (!username) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                return;
            }
            
            socket.emit('remove rank', { 
                username, 
                currentUser: { ...currentUser, roomId: currentRoom.id } 
            });
        }

        function showAllRanks() {
            socket.emit('show all ranks', { 
                currentUser: { ...currentUser, roomId: currentRoom.id } 
            });
        }

        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ±
        function selectAvatar(avatarKey) {
            if (!currentUser) return;
            
            const avatarUrl = defaultAvatars[avatarKey];
            socket.emit('update avatar', {
                username: currentUser.name,
                avatarUrl: avatarUrl,
                currentUser: { ...currentUser, roomId: currentRoom.id }
            });
        }

        function handleAvatarUpload() {
            if (!currentUser) return;
            
            const fileInput = document.getElementById('avatarUpload');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù ØµÙˆØ±Ø© ÙÙ‚Ø·', 'error');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                socket.emit('update avatar', {
                    username: currentUser.name,
                    avatarUrl: e.target.result,
                    currentUser: { ...currentUser, roomId: currentRoom.id }
                });
            };
            reader.readAsDataURL(file);
        }

        function resetAvatar() {
            if (!currentUser) return;
            
            const defaultAvatar = currentUser.gender === 'female' ? defaultAvatars.girl1 : defaultAvatars.boy1;
            socket.emit('update avatar', {
                username: currentUser.name,
                avatarUrl: defaultAvatar,
                currentUser: { ...currentUser, roomId: currentRoom.id }
            });
        }

        function updateAvatarPreview() {
            if (!currentUser) return;
            socket.emit('get avatar', currentUser.name);
        }

        function updateOnlineUsersAvatars(username, avatarUrl) {
            const userElements = document.querySelectorAll('#onlineUsersList .flex.items-center');
            userElements.forEach(element => {
                const userNameElement = element.querySelector('.font-semibold');
                if (userNameElement && userNameElement.textContent === username) {
                    const imgElement = element.querySelector('img');
                    if (imgElement) {
                        imgElement.src = avatarUrl;
                    } else {
                        const divElement = element.querySelector('.rounded-full');
                        if (divElement) {
                            divElement.innerHTML = `<img src="${avatarUrl}" class="w-10 h-10 rounded-full object-cover" alt="${username}">`;
                        }
                    }
                }
            });
        }

        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function toggleManagementFields() {
            const action = document.getElementById('userActionSelect').value;
            const durationField = document.getElementById('durationField');
            const reasonField = document.getElementById('reasonField');
            
            durationField.classList.add('hidden');
            reasonField.classList.add('hidden');
            
            if (action === 'mute') {
                durationField.classList.remove('hidden');
            } else if (['banFromRoom', 'banFromSite'].includes(action)) {
                reasonField.classList.remove('hidden');
            }
        }

        function clearManagementFields() {
            document.getElementById('managedUserName').value = '';
            document.getElementById('userActionSelect').value = '';
            document.getElementById('muteDuration').value = '';
            document.getElementById('banReason').value = '';
            document.getElementById('durationField').classList.add('hidden');
            document.getElementById('reasonField').classList.add('hidden');
        }

        function manageUser() {
            const username = document.getElementById('managedUserName').value.trim();
            const action = document.getElementById('userActionSelect').value;
            
            if (!username) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'error');
                return;
            }
            
            if (!action) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡', 'error');
                return;
            }
            
            if (action === 'mute') {
                const duration = document.getElementById('muteDuration').value;
                if (!duration || duration < 1) {
                    showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¯Ø© ÙƒØªÙ… ØµØ­ÙŠØ­Ø©', 'error');
                    return;
                }
                
                socket.emit('mute user', {
                    username,
                    duration,
                    currentUser: { ...currentUser, roomId: currentRoom.id }
                });
            } else if (action === 'unmute') {
                socket.emit('unmute user', {
                    username,
                    currentUser: { ...currentUser, roomId: currentRoom.id }
                });
            } else if (action === 'banFromRoom') {
                const reason = document.getElementById('banReason').value;
                socket.emit('ban from room', {
                    username,
                    reason,
                    currentUser: { ...currentUser, roomId: currentRoom.id }
                });
            } else if (action === 'unbanFromRoom') {
                socket.emit('unban from room', {
                    username,
                    currentUser: { ...currentUser, roomId: currentRoom.id }
                });
            } else if (action === 'banFromSite') {
                const reason = document.getElementById('banReason').value;
                socket.emit('ban from site', {
                    username,
                    reason,
                    currentUser: { ...currentUser, roomId: currentRoom.id }
                });
            } else if (action === 'unbanFromSite') {
                socket.emit('unban from site', {
                    username,
                    currentUser: { ...currentUser, roomId: currentRoom.id }
                });
            } else if (action === 'deleteUser') {
                if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ${username}ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.`)) {
                    socket.emit('delete user', {
                        username,
                        currentUser: { ...currentUser, roomId: currentRoom.id }
                    });
                }
            } else if (action === 'showStatus') {
                socket.emit('get user status', {
                    username,
                    currentUser: { ...currentUser, roomId: currentRoom.id }
                });
            }
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ÙˆØ§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø®Ø§ØµØ©
        function showUserProfileModal(username) {
            if (!currentUser) return;
            
            socket.emit('get user profile', { username });
        }

        function showUserProfile(profileData) {
            const modal = document.getElementById('profileModal');
            const avatar = document.getElementById('profileAvatar');
            const usernameElem = document.getElementById('profileUsername');
            const rankElem = document.getElementById('profileRank');
            const statusElem = document.getElementById('profileStatus');
            const statusDot = statusElem.querySelector('.w-3');
            const statusText = statusElem.querySelector('.text-sm');
            const privateChatButton = document.getElementById('privateChatButton');
            const addFriendButton = document.getElementById('addFriendButton');
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            avatar.src = profileData.avatar || (profileData.gender === 'female' ? defaultAvatars.girl1 : defaultAvatars.boy1);
            avatar.onerror = function() {
                this.src = profileData.gender === 'female' ? defaultAvatars.girl1 : defaultAvatars.boy1;
            };
            usernameElem.textContent = profileData.username;
            
            if (profileData.rank) {
                const rankInfo = ranks[profileData.rank];
                rankElem.textContent = `${rankInfo.icon} ${profileData.rank}`;
                rankElem.className = `inline-block mt-2 px-3 py-1 rounded-full text-sm font-semibold text-white bg-gradient-to-r ${rankInfo.color}`;
                rankElem.style.display = 'inline-block';
            } else {
                rankElem.style.display = 'none';
            }
            
            if (profileData.isOnline) {
                statusDot.className = 'w-3 h-3 rounded-full bg-green-500';
                statusText.textContent = 'ğŸŸ¢ Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†';
            } else {
                statusDot.className = 'w-3 h-3 rounded-full bg-red-500';
                statusText.textContent = 'ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„';
            }
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø®Ø§ØµØ© ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡
            if (profileData.username !== currentUser.name) {
                privateChatButton.style.display = 'flex';
                privateChatButton.setAttribute('data-username', profileData.username);
                
                // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚ ÙÙ‚Ø· Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù†ÙØ³Ù‡
                addFriendButton.style.display = 'flex';
                addFriendButton.setAttribute('data-username', profileData.username);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØµØ¯ÙŠÙ‚Ø§Ù‹ Ø¨Ø§Ù„ÙØ¹Ù„
                if (friendsList.includes(profileData.username)) {
                    addFriendButton.innerHTML = `
                        <span>ØµØ¯ÙŠÙ‚</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                    `;
                    addFriendButton.classList.remove('bg-green-600', 'hover:bg-green-700');
                    addFriendButton.classList.add('bg-gray-600', 'hover:bg-gray-700');
                    addFriendButton.disabled = true;
                } else {
                    addFriendButton.innerHTML = `
                        <span>Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚</span>
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"></path>
                        </svg>
                    `;
                    addFriendButton.classList.remove('bg-gray-600', 'hover:bg-gray-700');
                    addFriendButton.classList.add('bg-green-600', 'hover:bg-green-700');
                    addFriendButton.disabled = false;
                }
            } else {
                privateChatButton.style.display = 'none';
                addFriendButton.style.display = 'none';
            }
            
            modal.classList.add('show');
        }

        function closeProfileModal() {
            document.getElementById('profileModal').classList.remove('show');
        }

        function startPrivateChat() {
            const privateChatButton = document.getElementById('privateChatButton');
            const username = privateChatButton.getAttribute('data-username');
            
            if (!username) return;
            
            closeProfileModal();
            openPrivateChat(username);
        }

        function openPrivateChat(username) {
            privateChatTarget = username;
            const modal = document.getElementById('privateChatModal');
            const avatar = document.getElementById('privateChatAvatar');
            const usernameElem = document.getElementById('privateChatUsername');
            const statusElem = document.getElementById('privateChatStatus');
            const statusDot = statusElem.querySelector('.w-2');
            const statusText = statusElem.querySelector('span:last-child');
            
            // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù„Ø¹Ø±Ø¶Ù‡Ø§
            socket.emit('get user profile', { username });
            
            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            usernameElem.textContent = username;
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù†Ø§ÙØ°Ø©
            modal.classList.add('show');
            
            // ØªØ­Ù…ÙŠÙ„ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
            socket.emit('get private messages', {
                otherUser: username,
                currentUser: currentUser.name
            });
        }

        function closePrivateChat() {
            document.getElementById('privateChatModal').classList.remove('show');
            privateChatTarget = null;
        }

        function sendPrivateMessage() {
            if (!privateChatTarget) return;
            
            const input = document.getElementById('privateMessageInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            socket.emit('send private message', {
                toUser: privateChatTarget,
                message: message,
                fromUser: currentUser.name
            });
            
            input.value = '';
        }

        function handlePrivateKeyPress(event) {
            if (event.key === 'Enter') {
                sendPrivateMessage();
            }
        }

        function addPrivateMessageToChat(message, isOwn) {
            const container = document.getElementById('privateChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `mb-3 flex ${isOwn ? 'justify-end' : 'justify-start'}`;
            
            messageDiv.innerHTML = `
                <div class="max-w-xs px-3 py-2 rounded-xl ${
                    isOwn
                        ? 'bg-blue-600 text-white'
                        : 'bg-white/20 text-white'
                }">
                    <div class="text-sm">${message.content}</div>
                    <div class="text-xs opacity-70 mt-1">${message.time}</div>
                </div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // ÙˆØ¸ÙŠÙØ© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info') {
            const notificationsContainer = document.getElementById('globalNotifications');
            const notification = document.createElement('div');
            
            let bgColor = 'bg-blue-600';
            if (type === 'error') bgColor = 'bg-red-600';
            if (type === 'success') bgColor = 'bg-green-600';
            if (type === 'warning') bgColor = 'bg-yellow-600';
            
            notification.className = `${bgColor} text-white p-4 rounded-lg shadow-lg notification`;
            notification.innerHTML = `
                <div class="flex items-center space-x-3 space-x-reverse">
                    <span class="text-lg">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
                    <span>${message}</span>
                </div>
            `;
            
            notificationsContainer.appendChild(notification);
            
            // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }
        
        // ÙˆØ¸ÙŠÙØ© Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø¥Ù„Ù‰ Ø£Ø­Ø¯Ø« Ø±Ø³Ø§Ù„Ø©
        function scrollToBottom() {
            const container = document.getElementById('messagesContainer');
            if (container) {
                container.scrollTop = container.scrollHeight;
            }
        }
    </script>
</body>
</html>